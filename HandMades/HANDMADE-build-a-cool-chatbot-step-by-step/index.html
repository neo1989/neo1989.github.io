<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="我读书少，你莫骗我。"><title>Building a cool chatbot | 愚苏记</title><link rel="stylesheet" type="text/css" href="https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/lib/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="/lib/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="/lib/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="/lib/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="/lib/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script><!-- hexo-inject:begin --><!-- hexo-inject:end -->var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '96c862f2728296588ae9849f3bcb95db';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Building a cool chatbot</h1><a id="logo" href="/.">愚苏记</a><p class="description">To no avail but try.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-5-5"><div class="content_container no-padding-right"><div class="post"><h1 class="post-title">Building a cool chatbot</h1><div class="post-meta">Dec 6, 2022<span> | </span><span class="category"><a href="/categories/HandMades/">HandMades</a></span></div><a class="disqus-comment-count" data-disqus-identifier="HandMades/HANDMADE-build-a-cool-chatbot-step-by-step/" href="/HandMades/HANDMADE-build-a-cool-chatbot-step-by-step/#disqus_thread"></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Concepts"><span class="toc-number">1.</span> <span class="toc-text">Concepts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cornerstones"><span class="toc-number">2.</span> <span class="toc-text">Cornerstones</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#POS-Tagging"><span class="toc-number">2.1.</span> <span class="toc-text">POS Tagging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stemming-and-Lemmatization"><span class="toc-number">2.2.</span> <span class="toc-text">Stemming and Lemmatization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Named-Entity-Recognition"><span class="toc-number">2.3.</span> <span class="toc-text">Named-Entity Recognition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stop-Words"><span class="toc-number">2.4.</span> <span class="toc-text">Stop Words</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dependency-Parsing"><span class="toc-number">2.5.</span> <span class="toc-text">Dependency Parsing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Noun-Chunks"><span class="toc-number">2.6.</span> <span class="toc-text">Noun Chunks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Finding-Similarity"><span class="toc-number">2.7.</span> <span class="toc-text">Finding Similarity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tokenization"><span class="toc-number">2.8.</span> <span class="toc-text">Tokenization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Regular-Expressions"><span class="toc-number">2.9.</span> <span class="toc-text">Regular Expressions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Hard-Way"><span class="toc-number">3.</span> <span class="toc-text">The Hard Way</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#构建Rasa机器人的步骤"><span class="toc-number">3.1.</span> <span class="toc-text">构建Rasa机器人的步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Building-a-Simple-Horoscope-Bot"><span class="toc-number">3.2.</span> <span class="toc-text">Building a Simple Horoscope Bot</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Initializing-the-bot"><span class="toc-number">3.2.1.</span> <span class="toc-text">Initializing the bot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Preparing-data"><span class="toc-number">3.2.2.</span> <span class="toc-text">Preparing data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Training"><span class="toc-number">3.2.3.</span> <span class="toc-text">Training</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Test"><span class="toc-number">3.2.4.</span> <span class="toc-text">Test</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Run"><span class="toc-number">3.2.5.</span> <span class="toc-text">Run</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">4.</span> <span class="toc-text">References</span></a></li></ol></div></div><div class="post-content"><h2 id="Concepts">Concepts</h2>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><p><strong>Natural Language Processing (NLP)</strong> is a field of Artificial Intelligence that enables computers to analyze and understand the human language.</p>
<p><strong>Natural Language Understanding (NLU)</strong> is a subset of a bigger picture of NLP, just like machine learning, deep learning, NLP, and data mining are a subset of a bigger picture of Artificial Intelligence (AI), which is an umbrella term for any computer program that does something smart.</p>
<p><strong><a href="https://spacy.io/" target="_blank" rel="noopener">spaCy</a></strong> is an open-source software library for advanced NLP, written in Python and Cython. It provides intuitive APIs to access its methods trained by deep learning models.</p>
<h2 id="Cornerstones">Cornerstones</h2>
<p>Before we actually dive into spaCy and code snippets, make sure we have the necessary setup ready.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/chatBot &amp;&amp; <span class="built_in">cd</span> ~/chatBot</span><br><span class="line">pyenv virtualenv 3.8.5 chatBot</span><br><span class="line">pyenv <span class="built_in">local</span> chatBot</span><br><span class="line">pip install spacy==3.4.3</span><br></pre></td></tr></table></figure>
<p><a href="https://spacy.io/models" target="_blank" rel="noopener">spaCy models</a> are just like any other machine learning or deep learning models. A model is a yield of an algorithm or, say, an object that is created after training data using a machine learning algorithm. spaCy has lots of such models that can be placed directly in our program by downloading it just like any other Python package.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m spacy download zh_core_web_lg</span><br><span class="line">python -m spacy download en_core_web_lg</span><br></pre></td></tr></table></figure>
<h3 id="POS-Tagging">POS Tagging</h3>
<p>Part-of-speech (POS) tagging is a process where you read some text and assign parts of speech to each word or token, such noun, verb, adjective, etc.<br>
POS tagging becomes extremely important when you want to identify some entity in a given sentence. The first step is to do POS tagging and see what our text contains.<br>
Let’s get our hands dirty with some of the examples of real POS tagging.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spacy</span><br><span class="line">nlp = spacy.load(<span class="string">'zh_core_web_lg'</span>)</span><br><span class="line">doc = nlp(<span class="string">'明天的天气如何？'</span>)</span><br><span class="line"><span class="keyword">for</span> token <span class="keyword">in</span> doc:</span><br><span class="line">    print(token.text, token.pos_)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output #</span></span><br><span class="line">明天 NOUN</span><br><span class="line">的 PART</span><br><span class="line">天气 NOUN</span><br><span class="line">如何 VERB</span><br><span class="line">？ PUNCT</span><br></pre></td></tr></table></figure>
<h3 id="Stemming-and-Lemmatization">Stemming and Lemmatization</h3>
<p><strong>Stemming</strong> is the process of reducing inflected words to their word stem, base form.<br>
A stemming algorithm reduces the words “saying” to the root word “say”, whereas “presumable” becomes “presum”. As you can see, this may or may not always be 100% correct.<br>
<strong>Lemmatization</strong> is closely related to <strong>stemming</strong>, but lemmatization is the algorithmic process of determining the lemma of a word based on its intended meaning.<br>
spaCy doesn’t have any in-built stemmer, as lemmatization is considered more correct and productive. (spaCy 没有内置的词干提取器，因为词形还原被认为更加准确和有效。)<br>
Difference between Stemming and lemmatization:</p>
<ul>
<li><strong>Stemming</strong> does the job in a crude, heuristic way that chops off the ends of words, assuming that the remaining word is what we are actually looking for, but it often includes the removal of derivational affixes.</li>
<li><strong>Lemmatization</strong> tries to do the job more elegantly with the use of a vocabulary and morphological analysis of words. It tries its best to remove inflectional endings only and return the dictionary form of a word, konwn as the lemma.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> nltk.stem.porter <span class="keyword">import</span> PorterStemmer</span><br><span class="line">stemmer = PorterStemmer()</span><br><span class="line"><span class="keyword">for</span> w <span class="keyword">in</span> [<span class="string">'went'</span>, <span class="string">'goes'</span>]:</span><br><span class="line">    print(w, stemmer.stem(w))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output #</span></span><br><span class="line">went went</span><br><span class="line">goes goe</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spacy</span><br><span class="line">nlp = spacy.load(<span class="string">'en_core_web_lg'</span>)</span><br><span class="line"><span class="keyword">for</span> token <span class="keyword">in</span> nlp(<span class="string">'went goes'</span>):</span><br><span class="line">    print(token.text, token.lemma_)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output #</span></span><br><span class="line">went go</span><br><span class="line">goes go</span><br></pre></td></tr></table></figure>
<p>Since you are pretty much aware what a stemming or lemmatization does in NLP, you should be able to understand that whenever you come across a situation where you need the root form of the word, you need to do lemmatization there. For example, it is often used in building search engines. You must have wondered how Google gives you the articles in search results that you meant to get even when the search text was not properly formulated.<br>
This is where one makes use of lemmatization.<br>
Imageine you search with the text, “When will the next season of Game of Thrones be releasing?”<br>
Now, suppose the search engine does simple document word frequency matching to give you search results. In this case, the aforementioned query probably won’t match an article with a caption “Game of Thrones next season release date”.<br>
If we do the lemmatization of the orginal question before going to matchh the input with the documents, then we may get better results.</p>
<h3 id="Named-Entity-Recognition">Named-Entity Recognition</h3>
<p><strong>NER</strong>, also known by other names like <strong>entity identification</strong> or <strong>entity extraction</strong>, is a process of finding and classifying <a href="https://en.wikipedia.org/wiki/Named_entity" target="_blank" rel="noopener">named entities</a> existing in the given text into pre-defined categories.<br>
The NER task is hugely dependent on the knowledge base used to train the NE extraction algorithm, so it may or may not work depending upon the provided dataset it was trained on.<br>
spaCy comes with a very fast entiry recognition model that is capable of identifying entity phrases from a given document. Entities can be of different types, such as person, location, organization, dates, numerals, etc. These entities can be accessed through .ents property of the doc object.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spacy</span><br><span class="line">nlp = spacy.load(<span class="string">'zh_core_web_lg'</span>)</span><br><span class="line">doc = nlp(<span class="string">"欧盟拟向东南亚投资100亿欧元"</span>)</span><br><span class="line"><span class="keyword">for</span> ent <span class="keyword">in</span> doc.ents:</span><br><span class="line">    print(ent.text, ent.label_)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output #</span></span><br><span class="line">欧盟 ORG</span><br><span class="line">东南亚 LOC</span><br><span class="line"><span class="number">100</span>亿欧元 MONEY</span><br></pre></td></tr></table></figure>
<h3 id="Stop-Words">Stop Words</h3>
<p>Stop words are high-frequency words like a, an, the, to and also that we sometimes want to filter out of a document before further processing. Stop words usually have little lexical content and do not hold much of meaning.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> spacy.lang.zh.stop_words <span class="keyword">import</span> STOP_WORDS</span><br><span class="line">print(list(STOP_WORDS)[:<span class="number">10</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output #</span></span><br><span class="line">[<span class="string">'岂止'</span>, <span class="string">'当即'</span>, <span class="string">'纵'</span>, <span class="string">'▲'</span>, <span class="string">'几经'</span>, <span class="string">'上来'</span>, <span class="string">'什麽'</span>, <span class="string">'假使'</span>, <span class="string">'×'</span>, <span class="string">'『'</span>]</span><br></pre></td></tr></table></figure>
<p>Tosee if a word is a stop word or not, you can use the nlp object of spaCy. We can use the nlp object’s is_stop attribute.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nlp.vocab[<span class="string">"的"</span>].is_stop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output #</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h3 id="Dependency-Parsing">Dependency Parsing</h3>
<p>Dependency parsing is one of the more beautiful and powerful features of spaCy that is fast and accurate. The parser can also be used for sentence boundary detection and lets you iterate over base noun phrases, or “chunks”.<br>
This feature of spaCy gives you a parsed tree that explains the parent-child relationship between the words or phrases and is indenpendent of the order in which words occur.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spacy</span><br><span class="line">nlp = spacy.load(<span class="string">'en_core_web_lg'</span>)</span><br><span class="line">doc = nlp(<span class="string">"Book me a flight from Bangalore to Goa"</span>)</span><br><span class="line">print(doc[<span class="number">5</span>], list(doc[<span class="number">5</span>].ancestors))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output #</span></span><br><span class="line">Bangalore [<span class="keyword">from</span>, flight, Book]</span><br></pre></td></tr></table></figure>
<p>Ancestors are the rightmost token of this token’s syntactic descendants.<br>
To check if a doc object item is an ancestor of another <em>doc</em> object item programmactically, we can do the following:<br>
<code>doc[3].is_ancestor(doc[5])</code><br>
The above returns <code>True</code> because doc[3] (i.e., flight) is an ancestor of doc[5] (i.e., Bangalore).</p>
<p>Children are immediate syntactic dependents of the token. We can see the children of a word by using children attribute just like we used ancestors.<br>
<code> list(doc[3].children)</code> will output <code>[a, from, to]</code></p>
<p>Dependency parsing is one the most important parts when building chatbots from scratch. It becomes far more important when youn want to figure out the meaning of a text input from your user to your chatbot. There can be cases when you haven’t trained your chatbots, but still you don’t want to lose your customer or reply like a dumb machine.<br>
In these cases, dependency parsing really helps to find the relation and explain a bit more about what the user may be asking for.<br>
If we were to list things for which dependency parsing helps, some might be:</p>
<ul>
<li>It helps in finding relationships between words of grammatically correct sentences.</li>
<li>It can be used for sentence boundary detection.</li>
<li>It is quite useful to find out if the user is talking about more than one context simulationeously.<br>
You need to write your own custom NLP to understand the context of the user or your chatbot and, based on that, identify the possible grammatical mistakes a user can meke.</li>
</ul>
<p>All in all, you must b ready for such scenarious where a user will input garbage values or grammatically incorrect sentences. You can’t handle all such scenarios at once, but you can keep improve you chatboot by adding custom NLP code or by limiting user input by design.</p>
<h3 id="Noun-Chunks">Noun Chunks</h3>
<p>Noun chunks or NP-chunking are basically “base noun phrases”. We can say they are flat phrases that have anoun as their head. You can think of noun chunks as a noun with the words describing the noun.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spacy</span><br><span class="line">nlp = spacy.load(<span class="string">'en_core_web_lg'</span>)</span><br><span class="line">doc = nlp(<span class="string">"Boston Dynamics is gearing up to produce thousands of robot dogs"</span>)</span><br><span class="line">print(list(doc.noun_chunks))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output #</span></span><br><span class="line">[Boston Dynamics, thousands, robot dogs]</span><br></pre></td></tr></table></figure>
<p><strong>The ‘noun_chunks’ syntax iterator is not implemented for language 'zh’</strong></p>
<h3 id="Finding-Similarity">Finding Similarity</h3>
<p>Finding similarity between two words is a use-case you will find most of the time working with NLP. Sometimes it becomes fairly important to find if two words are similar. While building chatbots you will often come to situations where you don’t have to just find similar-lokking words but also how closely related two words are logically.<br>
spaCy uses high-quality word vectors to find similarity between two words using <strong>GloVe algorithm</strong> (Global Vectors for Word Representation).<br>
GloVe is an unsupervised learning algorithm for obtaining vector representations for words. GloVe algorithm uses aggregated global word-word co-occurrence statistics from a corpus to train the model.</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spacy</span><br><span class="line">nlp = spacy.load(<span class="string">'zh_core_web_lg'</span>)</span><br><span class="line">doc = nlp(<span class="string">"美团小贷注册资本增至75亿元"</span>)</span><br><span class="line"><span class="keyword">for</span> token <span class="keyword">in</span> doc:</span><br><span class="line">     print(token.text, token.vector[:<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Output #</span><br><span class="line">美团 [<span class="number">-0.78366</span>  <span class="number">0.31008</span> <span class="number">-1.0793</span>  <span class="number">-0.87563</span>  <span class="number">0.56224</span>]</span><br><span class="line">小贷 [ <span class="number">1.0563</span>  <span class="number">-2.695</span>   <span class="number">-0.44203</span>  <span class="number">0.98277</span> <span class="number">-4.8158</span> ]</span><br><span class="line">注册 [ <span class="number">3.4941</span> <span class="number">-2.8909</span> <span class="number">-4.572</span>  <span class="number">-2.0436</span> <span class="number">-1.9986</span>]</span><br><span class="line">资本 [ <span class="number">3.8849</span>  <span class="number">0.3031</span> <span class="number">-2.382</span>   <span class="number">2.8471</span> <span class="number">-2.7938</span>]</span><br><span class="line">增至 [ <span class="number">1.469</span>   <span class="number">1.0054</span>  <span class="number">5.4963</span>  <span class="number">1.8396</span> <span class="number">-3.7624</span>]</span><br><span class="line"><span class="number">75</span>亿 [ <span class="number">0.3056</span>   <span class="number">0.69498</span>  <span class="number">1.4444</span>   <span class="number">0.91454</span> <span class="number">-0.97031</span>]</span><br><span class="line">元 [ <span class="number">2.8509</span>  <span class="number">-0.53181</span> <span class="number">-2.646</span>   <span class="number">-0.5862</span>  <span class="number">-4.0398</span> ]</span><br></pre></td></tr></table></figure>
<p>Seeing this output, it doesn’t make much sense and meaning. From an application’s perspective, what matters the most is how similar the vectors of different words are – that is, the word’s meaning itself.<br>
In order to find similarity between two words in spaCy, we can do the following.</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import spacy</span><br><span class="line">nlp = spacy.load(<span class="string">'en_core_web_lg'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(nlp(<span class="string">"car"</span>).similarity(nlp(<span class="string">"truck"</span>)))</span><br><span class="line"><span class="builtin-name">print</span>(nlp(<span class="string">"car"</span>).similarity(nlp(<span class="string">"plane"</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output #</span></span><br><span class="line">0.7760473774094219</span><br><span class="line">0.4592993678544094</span><br></pre></td></tr></table></figure>
<p>The word ‘car’ is more related and similar to the word ‘truck’ than the word ‘plane’.<br>
We can also get the similarity between sentences.</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">import</span> spacy</span><br><span class="line"><span class="attr">nlp</span> = spacy.load('en_core_web_lg')</span><br><span class="line"><span class="attr">str1</span> = nlp(<span class="string">"When will next season of Game of Thrones be releasing?"</span>)</span><br><span class="line"><span class="attr">str2</span> = nlp(<span class="string">"Game of Thrones next season release date?"</span>)</span><br><span class="line">print(str1.similarity(str2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output #</span></span><br><span class="line"><span class="number">0.8226084934378249</span></span><br></pre></td></tr></table></figure>
<p>As we can see in this example, the similarity between both of the sentences is about 82%, which is good enough to say that both of the sentences are quite similar, which is true. This can help us save a lot of time for writing custom code when build chatbots.</p>
<h3 id="Tokenization">Tokenization</h3>
<p>Tokenization is one of the simple yet basic concepts of NLP where we split a text into meaningful segments. spaCy first tokenizes the text (i.e., segments it into words and then punctuation and other things). A question might come to your mind: Why can’t I just use the built-in split method of Python language and do the tokenization? Python’s split method is just a raw method to split the sentence into tokens given a sepatator. It doesn’t take any meaning into account, whereas tokenization tries to preserve the meaning as well.</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spacy</span><br><span class="line">nlp = spacy.load(<span class="string">'zh_core_web_lg'</span>)</span><br><span class="line">doc = nlp(<span class="string">"告诉我处女座今天的运势"</span>)</span><br><span class="line">for tk <span class="keyword">in</span> doc:</span><br><span class="line">    print(tk.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Output #</span><br><span class="line">告诉</span><br><span class="line">我</span><br><span class="line">处女座</span><br><span class="line">今天</span><br><span class="line">的</span><br><span class="line">运势</span><br></pre></td></tr></table></figure>
<p>If you are not satisfied with spaCy’s tokenization, you can use its <em>add_special_case</em> method to add your own rules before relying completely on spaCy’s tokenization method.</p>
<h3 id="Regular-Expressions">Regular Expressions</h3>
<p>You must already know about regular expressions and their usage.<br>
Text analysis and processing is a big subject in itself. Sometimes words play together in a way that makes it extremely difficult for machines to understand and get trained upon.<br>
Regular expression can come handy for some fallback for a machine learning model. It has the power of pattern-matching, which can ensure that the data we are processing is correct or incorrect. Most of the early chatbots were hugely dependent on pattern-matching.<br>
Given the power of machine learning these days, regular expression and pattern-matching has taken a back step, but make sure you brush up a bit about it as it may be needed at any time to parse specific details from words, sentences, or text documents.</p>
<h2 id="The-Hard-Way">The Hard Way</h2>
<p>“Building Chatbots the Hard Way” is not to hard to learn. It’s the hard way of building chatbots to have full control over your own chatbots. If you want to build everything yourself, then you take the hard route. The harder route is hard when you go through it but beautiful and clear when you look back.</p>
<blockquote>
<p>It is a rough road that leads to the heights of etness. – Lucius Annaeus Seneca</p>
</blockquote>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install rasa==<span class="number">3.4</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>
<h3 id="构建Rasa机器人的步骤">构建Rasa机器人的步骤</h3>
<ul>
<li>初始化项目</li>
<li>准备NLU训练数据</li>
<li>准备故事story</li>
<li>定义领域domain</li>
<li>定义规则rule</li>
<li>定义动作action</li>
<li>配置config</li>
<li>训练模型</li>
<li>测试机器人</li>
<li>发布机器人</li>
</ul>
<h3 id="Building-a-Simple-Horoscope-Bot">Building a Simple Horoscope Bot</h3>
<p>Let’s decide the scope of this chatbot and see what it does and can do.</p>
<ul>
<li>The Horoscope Bot should be able to understand greetings and reply with a greeting.</li>
<li>The bot should be able to understand if there user is asking for horoscope.</li>
<li>The bot should be able to ask the horoscope sign of the user if the user doesn’t provide it.</li>
<li>The bot should learn from existing responses to formulate a new response.<br>
It is pretty simple what our bot is supposed to do here.</li>
</ul>
<p>Possible intents</p>
<ul>
<li>Greeting Intent: User starting with a greeting</li>
<li>Get Horoscope Intent: User asking for horoscope</li>
<li>User’s Horoscope Intent: User telling the horoscope sign</li>
</ul>
<p>We’ll try to build the bot that does the basic task of giving a horoscope.<br>
Let’s create a possible conversation script between our chatbot and the user.</p>
<pre><code>User: Hello
Bot: 你好，有什么能帮到你？
User: 看一下今年的运势
Bot: 想查哪个星座的运势?
User: 双鱼的
Bot: 由于天王星的逆行，可能会打乱双鱼座的节奏，所以双鱼座本年要懂得韬光养晦，要努力的去沉淀自己...
</code></pre>
<p>This conversation is just to have a fair idea of how our chatbot conversation is going to look.<br>
We can have our chatbot model itself trained to prepare a valid response instead of writing a bunch of <code>if ... else</code> statements.</p>
<h4 id="Initializing-the-bot">Initializing the bot</h4>
<p>Let’s init our bot.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/chatBot</span><br><span class="line">rasa init --no-prompt</span><br></pre></td></tr></table></figure>
<h4 id="Preparing-data">Preparing data</h4>
<p>First, prepare the <strong>nlu</strong> data. (nlu负责意图提取和实体提取)<br>
The following is what my <strong><code>nlu.yml</code></strong> under <strong>data</strong> folder looks like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.1"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">nlu:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">greet</span></span><br><span class="line">    <span class="attr">examples:</span> <span class="string">|</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hi</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hello</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">goodbye</span></span><br><span class="line">    <span class="attr">examples:</span> <span class="string">|</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bye</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">goodbye</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">get_horoscope</span></span><br><span class="line">    <span class="attr">examples:</span> <span class="string">|</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">查一下[今天](date_time)的运势</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">看一下[狮子座](horoscope_sign)如何</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">info_date_time</span></span><br><span class="line">    <span class="attr">examples:</span> <span class="string">|</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">[今日](date_time)</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">[明天](date_time)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">info_horoscope_sign</span></span><br><span class="line">    <span class="attr">examples:</span> <span class="string">|</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">[白羊](horoscope_sign)</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">[金牛](horoscope_sign)</span></span><br></pre></td></tr></table></figure>
<p>Then, prepare the <strong>stories</strong> data (Rasa是通过学习story的方式来学习对话管理知识).<br>
The following is what my <strong><code>stories.yml</code></strong> under <strong>data</strong> folder looks like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.1"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stories:</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">story:</span> <span class="string">greet</span></span><br><span class="line">  <span class="attr">steps:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">greet</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">utter_greet</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">story:</span> <span class="string">say</span> <span class="string">goodbye</span></span><br><span class="line">  <span class="attr">steps:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">goodbye</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">utter_goodbye</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">story:</span> <span class="string">get</span> <span class="string">horoscope</span></span><br><span class="line">  <span class="attr">steps:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">or:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">get_horoscope</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">get_horoscope</span></span><br><span class="line">      <span class="attr">entities:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">horoscope_sign:</span> <span class="string">双鱼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">get_horoscope</span></span><br><span class="line">      <span class="attr">entities:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">date_time:</span> <span class="string">今天</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">get_horoscope</span></span><br><span class="line">      <span class="attr">entities:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">horoscope_sign:</span> <span class="string">双鱼</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">date_time:</span> <span class="string">今天</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">horoscope_form</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">active_loop:</span> <span class="string">horoscope_form</span></span><br></pre></td></tr></table></figure>
<p>Then, prepare the <strong>domain</strong> data (domain定义了chatbot需要知道的所有信息，包括intent, entity, slot, action, form, response).<br>
The following is what my <strong><code>domain.yml</code></strong> under project root looks like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.1"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">intents:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">greet</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">goodbye</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get_horoscope</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">info_date_time</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">info_horoscope_sign</span></span><br><span class="line"></span><br><span class="line"><span class="attr">entities:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">date_time</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">horoscope_sign</span></span><br><span class="line"></span><br><span class="line"><span class="attr">slots:</span></span><br><span class="line">  <span class="attr">date_time:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">text</span></span><br><span class="line">    <span class="attr">influence_conversation:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">mappings:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">date_time</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">from_entity</span></span><br><span class="line">        <span class="attr">conditions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">active_loop:</span> <span class="string">horoscope_form</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">horoscope_sign:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">text</span></span><br><span class="line">    <span class="attr">influence_conversation:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">mappings:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">horoscope_sign</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">from_entity</span></span><br><span class="line">        <span class="attr">conditions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">active_loop:</span> <span class="string">horoscope_form</span></span><br><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">utter_greet:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">text:</span> <span class="string">"你好，有什么能帮到你？"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">utter_goodbye:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">text:</span> <span class="string">"再见"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">utter_ask_horoscope_sign:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">text:</span> <span class="string">"想查哪个星座的运势?"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">utter_ask_date_time:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">text:</span> <span class="string">"想查今天、明天、本周、本月还是今年的运势？"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">actions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">utter_greet</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">utter_goodbye</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">utter_ask_horoscope_sign</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">utter_ask_date_time</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">action_get_horoscope</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">action_default_fallback</span></span><br><span class="line"></span><br><span class="line"><span class="attr">forms:</span></span><br><span class="line">  <span class="attr">horoscope_form:</span></span><br><span class="line">    <span class="attr">ignored_intents:</span> <span class="string">[]</span></span><br><span class="line">    <span class="attr">required_slots:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">date_time</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">horoscope_sign</span></span><br><span class="line"></span><br><span class="line"><span class="attr">session_config:</span></span><br><span class="line">  <span class="attr">session_expiration_time:</span> <span class="number">60</span></span><br><span class="line">  <span class="attr">carry_over_slots_to_new_session:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>Then, prepare the <strong>rule</strong> (rule负责将问题分类映射到对应的动作上).<br>
The following is what my <strong><code>rules.yml</code></strong> under <strong>data</strong> folder looks like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.1"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">rule:</span> <span class="string">activate</span> <span class="string">horoscope</span> <span class="string">form</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">intent:</span> <span class="string">get_horoscope</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">horoscope_form</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">active_loop:</span> <span class="string">horoscope_form</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">rule:</span> <span class="string">submit</span> <span class="string">form</span></span><br><span class="line">    <span class="attr">condition:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">active_loop:</span> <span class="string">horoscope_form</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">horoscope_form</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">active_loop:</span> <span class="literal">null</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">slot_was_set:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">requested_slot:</span> <span class="literal">null</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">action_get_horoscope</span></span><br></pre></td></tr></table></figure>
<p>Then, prepare the <strong>action</strong> (action接收用户输入和对话状态信息，按照业务逻辑进行处理，并输出改变对话状态的事件和回复用户的消息).<br>
The following is what my <strong><code>actions.py</code></strong> under <strong>actions</strong> folder looks like:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ActionGetHoroscope</span><span class="params">(Action)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self)</span> -&gt; Text:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"action_get_horoscope"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self, dispatcher: CollectingDispatcher,</span></span></span><br><span class="line"><span class="function"><span class="params">            tracker: Tracker,</span></span></span><br><span class="line"><span class="function"><span class="params">            domain: Dict[Text, Any])</span> -&gt; List[Dict[Text, Any]]:</span></span><br><span class="line"></span><br><span class="line">        date_time = tracker.get_slot(<span class="string">"date_time"</span>)</span><br><span class="line">        horoscope_sign = tracker.get_slot(<span class="string">"horoscope_sign"</span>)</span><br><span class="line"></span><br><span class="line">        dispatcher.utter_message(</span><br><span class="line">            text=json_object.get(horoscope_sign, &#123;&#125;) \</span><br><span class="line">                            .get(date_time, <span class="string">"抱歉，我目前无法找到您的运势"</span>)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ActionDefaultFallback</span><span class="params">(Action)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self)</span> -&gt; Text:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"action_default_fallback"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        self,</span></span></span><br><span class="line"><span class="function"><span class="params">        dispatcher: CollectingDispatcher,</span></span></span><br><span class="line"><span class="function"><span class="params">        tracker: Tracker,</span></span></span><br><span class="line"><span class="function"><span class="params">        domain: Dict[Text, Any],</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span> -&gt; List[Dict[Text, Any]]:</span></span><br><span class="line">        dispatcher.utter_message(text=<span class="string">"我不明白您说的内容，请换个说法。"</span>)</span><br><span class="line">        <span class="keyword">return</span> [UserUtteranceReverted(), ]</span><br></pre></td></tr></table></figure>
<p>Then, prepare the <strong>config</strong>.<br>
The following is what my <strong>config.yml</strong> under project root looks like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">recipe:</span> <span class="string">default.v1</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh</span></span><br><span class="line"><span class="attr">pipeline:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SpacyNLP</span></span><br><span class="line">    <span class="attr">model:</span> <span class="string">zh_core_web_lg</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SpacyTokenizer</span></span><br><span class="line">    <span class="attr">intent_tokenization_flag:</span> <span class="literal">False</span></span><br><span class="line">    <span class="attr">intent_split_symbol:</span> <span class="string">"_"</span></span><br><span class="line">    <span class="attr">token_pattern:</span> <span class="string">None</span></span><br><span class="line">  <span class="comment"># - name: WhitespaceTokenizer</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RegexFeaturizer</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LexicalSyntacticFeaturizer</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CountVectorsFeaturizer</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CountVectorsFeaturizer</span></span><br><span class="line">    <span class="attr">analyzer:</span> <span class="string">char_wb</span></span><br><span class="line">    <span class="attr">min_ngram:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">max_ngram:</span> <span class="number">4</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DIETClassifier</span></span><br><span class="line">    <span class="attr">epochs:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">constrain_similarities:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">EntitySynonymMapper</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ResponseSelector</span></span><br><span class="line">    <span class="attr">epochs:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">constrain_similarities:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FallbackClassifier</span></span><br><span class="line">    <span class="attr">threshold:</span> <span class="number">0.3</span></span><br><span class="line">    <span class="attr">ambiguity_threshold:</span> <span class="number">0.1</span></span><br><span class="line"><span class="attr">policies:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MemoizationPolicy</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TEDPolicy</span></span><br><span class="line">    <span class="attr">max_history:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">epochs:</span> <span class="number">200</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RulePolicy</span></span><br><span class="line">    <span class="attr">core_fallback_threshold:</span> <span class="number">0.5</span></span><br><span class="line">    <span class="attr">core_fallback_action_name:</span> <span class="string">action_default_fallback</span></span><br><span class="line">    <span class="attr">enable_fallback_prediction:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="Training">Training</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rasa train</span><br></pre></td></tr></table></figure>
<h4 id="Test">Test</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rasa <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>Ok, if everything goes well, we’ve got a simple chatbot out there.</p>
<h4 id="Run">Run</h4>
<p>Run an action server.</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rasa <span class="built_in">run</span> actions <span class="comment">--actions actions.actions</span></span><br></pre></td></tr></table></figure>
<p>Run a shell</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rasa <span class="keyword">shell</span></span><br></pre></td></tr></table></figure>
<p>Let’s play with it in that shell.</p>
<p><img src="http://s3.mindex.xyz/blog/HandMades/5f12e717d8eb6d73616a80621a19ef31.png" alt="Test Case"></p>
<p>Try it out for yourself.</p>
<h2 id="References">References</h2>
<ul>
<li><a href="https://www.amazon.com/Building-Chatbots-Python-Language-Processing/dp/1484240952/" target="_blank" rel="noopener">Building Chatbots with Python</a></li>
<li><a href="https://www.amazon.cn/dp/B09T353ZJF" target="_blank" rel="noopener">RASA实战</a></li>
<li><a href="https://github.com/neo1989/chatbot" target="_blank" rel="noopener">chatbot-github</a></li>
</ul>
</div><iframe src="/donate/?AliPayQR=null&amp;WeChatQR=http://s3.mindex.xyz/mp/qrcode-s.jpg&amp;GitHub=http://github.com/neo1989&amp;BTCQR=null&amp;BTCKEY=null&amp;PayPal=null" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><div><ul class="post-copyright"><li class="post-copyright-author"><strong>Author: </strong>尼欧</li><li class="post-copyright-link"><strong>Blog Link: </strong><a href="/HandMades/HANDMADE-build-a-cool-chatbot-step-by-step/">https://neo1989.net/HandMades/HANDMADE-build-a-cool-chatbot-step-by-step/</a></li><li class="post-copyright-license"><strong>Copyright Declaration: </strong>转载请声明出处。</li></ul></div><br><div class="tags"><a href="/tags/Coder/">Coder</a><a href="/tags/NLP/">NLP</a><a href="/tags/AI/">AI</a></div><div class="post-nav"><a class="pre" href="/Notes/NOTE-personality-disorder/">人格障碍</a><a class="next" href="/Notes/NOTE-AI3.0/">《AI 3.0》</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://neo1989.net/HandMades/HANDMADE-build-a-cool-chatbot-step-by-step/';
    this.page.identifier = 'HandMades/HANDMADE-build-a-cool-chatbot-step-by-step/';
    this.page.title = 'Building a cool chatbot';
  };</script><!-- script(type='text/javascript' id='disqus-lazy-load-script').--><!--   $.ajax({--><!--   url: 'https://disqus.com/next/config.json',--><!--   timeout: 2500,--><!--   type: 'GET',--><!--   success: function(){--><!--     var d = document;--><!--     var s = d.createElement('script');--><!--     s.src = '//#{theme.disqus}.disqus.com/embed.js';--><!--     s.setAttribute('data-timestamp', + new Date());--><!--     (d.head || d.body).appendChild(s);--><!--     $('.disqus_click_btn').css('display', 'none');--><!--   },--><!--   error: function() {--><!--     $('.disqus_click_btn').css('display', 'block');--><!--   }--><!--   });--><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//neo1989.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://neo1989.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div></div><div class="pure-u-1 pure-u-md-4-6"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">愚苏记.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/i-yard/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho/maupassant"> Cho.</a></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="/lib/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="/lib/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" id="maid-script" mermaidoptioins="{&quot;startOnload&quot;:true,&quot;theme&quot;:&quot;forest&quot;}" src="/js/mermaid.min.js?v=1.0.0"></script><script>if (window.mermaid) {
  var options = JSON.parse(document.getElementById('maid-script').getAttribute('mermaidoptioins'));
  mermaid.initialize(options);
}</script></div><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>